document.addEventListener("DOMContentLoaded",(()=>{const body=document.querySelector("body");let resizeTimer=null;const rem=function(e,t){return null==t&&(t=16),e/t+"rem"},hNavBtn=document.querySelector(".h-nav-btn"),hNavModal=document.querySelector(".h-nav-modal");window.addEventListener("resize",(()=>{clearTimeout(resizeTimer),resizeTimer=setTimeout((()=>{hNavModal&&"none"==getComputedStyle(hNavBtn).display&&hNavModal.close()}),250)}));const blocEmbeds=document.querySelectorAll(".bloc-embed");blocEmbeds.forEach((e=>{const t=e.querySelector("iframe"),r=t.dataset.src,a=e.querySelector(".iframe-accept");e.querySelector("button").addEventListener("click",(()=>{t.setAttribute("src",r),a.remove()}))}));const searchBtn=document.querySelector(".h-btn-toggle-search");if(searchBtn){const e=window.getComputedStyle(searchBtn.parentNode),t=document.querySelector("#header-form-search-box"),r=t.querySelectorAll("button,input"),a=()=>{"false"==searchBtn.getAttribute("aria-expanded")?(searchBtn.setAttribute("aria-expanded",!0),searchBtn.setAttribute("aria-label","Masquer le formulaire de recherche"),t.setAttribute("aria-hidden","false"),r.forEach((e=>{e.removeAttribute("tabindex")}))):(searchBtn.setAttribute("aria-expanded",!1),searchBtn.setAttribute("aria-label","Afficher le formulaire de recherche"),t.setAttribute("aria-hidden","true"),r.forEach((e=>{e.setAttribute("tabindex","-1")})))},n=()=>{"none"!=e.display?(searchBtn.classList.add("active"),searchBtn.addEventListener("click",a),t.setAttribute("aria-hidden","true"),r.forEach((e=>{e.setAttribute("tabindex","-1")}))):"none"==e.display&&searchBtn.classList.contains("active")&&(searchBtn.classList.remove("active"),searchBtn.setAttribute("aria-expanded",!1),searchBtn.setAttribute("aria-label","Afficher le formulaire de recherche"),searchBtn.removeEventListener("click",a),t.removeAttribute("aria-hidden"),r.forEach((e=>{e.removeAttribute("tabindex")})))};n();let o=null;window.addEventListener("resize",(()=>{clearTimeout(o),o=setTimeout(n,250)}))}const btnOpenModal=document.querySelectorAll(".modal-btn-open"),focusableElsQuery=':is(a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], input[type="number"], input[type="date"], select):not([disabled])',trapFocus=(e,t,r)=>{e.addEventListener("keydown",(function(e){("Tab"===e.key||9===e.keyCode)&&(e.shiftKey?document.activeElement===t&&(r.focus(),e.preventDefault()):document.activeElement===r&&(t.focus(),e.preventDefault()))}))};btnOpenModal&&btnOpenModal.forEach((e=>{const t=document.querySelector("#"+e.getAttribute("aria-control")),r=t.querySelectorAll(".modal-btn-close"),a=t.querySelectorAll(focusableElsQuery),n=a[0],o=a[a.length-1];e.addEventListener("click",(()=>{t.showModal(),n&&n.focus(),body.style.overflow="hidden"})),r.forEach((r=>{r.addEventListener("click",(()=>{t.close(),e.focus(),body.style.overflow="auto"}))})),t.addEventListener("click",(r=>{console.log(r.target),r.target===t&&(t.close(),e.focus(),body.style.overflow="auto")})),trapFocus(t,n,o)}));const mapBlocs=document.querySelectorAll(".bloc-map");mapBlocs.length>0&&mapBlocs.forEach((bloc=>{const container=bloc.querySelector(".map"),args=eval("mapArgs_"+container.id),center=[args.lat,args.lng],map=L.map(container.id,{scrollWheelZoom:!1,tap:!1}).setView(center,13);L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoicGFwaWVyY29kZSIsImEiOiJjbTZhbTMwZTkwaXNvMm1zaWU4ZnR2NmFnIn0.KKkR3402RzV80Du2Hu1gLg",{id:"papiercode/cm69i1x8x001t01r5568bhc7w",tileSize:512,zoomOffset:-1}).addTo(map);const marker=L.marker(center,{icon:L.divIcon({html:args.marker.svg,iconSize:[args.marker.width,args.marker.height],popupAnchor:[0,-.5*args.height]})}).addTo(map)}));const inputFiles=document.querySelectorAll('input[type="file"');inputFiles.length>0&&inputFiles.forEach((e=>{let t=e.parentElement.querySelector(".input-file-btn"),r=e.parentElement.querySelector(".input-file-msg");t.addEventListener("click",(()=>{e.click()})),e.addEventListener("change",(e=>{let t=e.currentTarget.value;t.includes("fakepath")&&(t=t.substring(12)),r.textContent=t}))}))}));